<p-toast key="compacct-toast" baseZIndex="99999">
</p-toast>
<p-toast position="center" key="c" (onClose)="onReject()" [modal]="true" [autoZIndex]="true">
    <ng-template let-message pTemplate="message">
        <div style="text-align: center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3em"></i>
            <h3>{{message.summary}}</h3>
            <p>{{message.detail}}</p>
        </div>

        <!-- <div *ngIf="checkSave" class="ui-g ui-fluid">
          <div class="ui-g-6">
              <button type="button" pButton (click)="onConfirm()" label="Yes" class="ui-button-success"></button>
          </div>
          <div class="ui-g-6">
              <button type="button" pButton (click)="onReject()" label="No" class="ui-button-secondary"></button>
          </div>
      </div> -->

    </ng-template>
</p-toast>

<div class="row">
    <div class="col-xs-12">
        <div class="box box-primary">
            <div class="form-horizontal">
                <div class="box-body">
                    <p-tabView [activeIndex]="tabIndexToView" (onChange)="TabClick($event)">
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[0]" leftIcon="glyphicon glyphicon-list-alt">
                            <!-- <form name="SearchForm" #SearchForm="ngForm" novalidate> -->
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <label class="control-label">Date</label>

                                    <app-compacct-daterangepicker (DaterangeObj)="getDateRange($event)">
                                    </app-compacct-daterangepicker>

                                </div>

                                <div class="col-sm-3">
                                    <button class="btn btn-primary custombutton3" data-toggle="modal" (click)="GetSearchedlist()" id="load" [disabled]="seachSpinner">
                                      <p-progressSpinner
                                        *ngIf="seachSpinner"
                                        [style]="{ width: '15px', height: '15px' }"
                                        strokeWidth="8"
                                        animationDuration=".5s"
                                      ></p-progressSpinner>
                                      <span
                                        *ngIf="!seachSpinner"
                                        class="glyphicon glyphicon-search"
                                      ></span
                                      >&nbsp;Search
                                    </button>
                                </div>
                                <div class="col-sm-2">
                                    <label class="control-label"></label>

                                    <div class="checkBox">
                                        <label class="pullright2">
                                       <p-checkbox  [(ngModel)]="ApprovedFLag"  name="Approved"  (onChange)="ApprovedCheckBox()"  binary="true" ></p-checkbox>
                                       Approved
                                   </label>
                                    </div>
                                </div>
                            </div>
                            <!-- </form> -->
                            <div class="row">
                                <div class="col-sm-8">
                                    <h5><strong></strong></h5>
                                </div>
                            </div>
                            <div class="table-responsive table-id">
                                <p-table [value]="Searchedlist" #dt1 [paginator]="true" [rows]="100" [loading]="seachSpinner" [rowHover]="true" [autoLayout]="true" sortMode="multiple" [rowsPerPageOptions]="[10,25,50,100]" [rowHover]="true" [globalFilterFields]='["Doc_No","Doc_Date","Amount","Confirm_Amount","Autho_One_Staus"]'>
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right">
                                                <input type="text" pInputText size="50" placeholder="Search" (input)="dt1.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:5em">Action</th>
                                            <th>Doc No</th>
                                            <th>Date</th>
                                            <th>Total Amount</th>
                                            <th>Confirm Amount</th>
                                            <th>Confirm Status </th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col>
                                        <tr>
                                            <td>
                                                <div class="dropdown">
                                                    <button class="btn btn-default btn-sm tableButton dropdown-toggle" type="button" data-toggle="dropdown" style="height:27px">
                                                            <i class="fa fa-fw fa-bars"></i>
                                                            <span class="caret"></span>
                                                        </button>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a (click)="View(col)">
                                                                <i class="fa fa-fw fa-eye" aria-hidden="true"></i> View
                                                            </a>
                                                        </li>
                                                        <!-- <li *ngIf= "col.Toyal_Qty != col.Accepted_Qty && $CompacctAPI.CompacctCookies.Cost_Cen_ID == col.F_Cost_Cen_ID">
                                                                  <a (click)="edit(col)">
                                                                    <i class="fa fa-fw fa-pencil" aria-hidden="true"></i>
                                                                    Edit
                                                                </a>
                                                            </li> -->
                                                        <li *ngIf="$CompacctAPI.CompacctCookies.User_Type == 'M'  && col.Autho_One_Staus == 'NO'">
                                                            <a (click)="Authorized(col)">
                                                                <i class="fa fa-check"></i> Authorized
                                                            </a>
                                                        </li>
                                                        <li *ngIf="$CompacctAPI.CompacctCookies.User_Type == 'A'">
                                                            <a (click)="Authorized(col)">
                                                                <i class="fa fa-check"></i> Authorized
                                                            </a>
                                                        </li>

                                                        <li>
                                                            <a (click)="exportoexcel2(col,'Purchase_Planning')">
                                                                <i class="glyphicon glyphicon-save" aria-hidden="true"></i> export to excel
                                                            </a>
                                                        </li>
                                                        <!-- <li *ngIf = "col.Accepted_Qty == 0  &&  $CompacctAPI.CompacctCookies.Cost_Cen_ID != col.To_Cost_Cen_ID">
                                                                <a (click)="Delete(col)">
                                                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                                                    Delete
                                                                </a>
                                                            </li> -->
                                                    </ul>
                                                </div>
                                            </td>
                                            <td>{{col.Doc_No}}</td>
                                            <td>{{col.Doc_Date | date : 'dd/MMM/yyyy'}}</td>
                                            <td>{{col.Amount}}</td>
                                            <td>{{col.Confirm_Amount ? col.Confirm_Amount : '-'}}</td>
                                            <td>{{col.Autho_One_Staus }}</td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="paginatorright" let-state>
                                        Showing {{state.first+1}} of {{(state.first+1) + state.rows}} of {{state.totalRecords}}
                                    </ng-template>
                                </p-table>

                            </div>

                        </p-tabPanel>

                        <!-- Authorized POPUP -->
                        <p-dialog header="Details" [appendTo]="'body'" [(visible)]="AuthPoppup" [modal]="true" [responsive]="true" [minY]="70" [maximizable]="true" [closeOnEscape]="true" [style]="{width: '80%', minWidth: '300px'}">
                            <div class="form-group">
                                <div class="col-sm-3">
                                    <label class="control-label">Date</label>
                                    <div class="label-t">{{Doc_date | date :"dd/MMM/yyyy"}}</div>

                                </div>
                                <div class="col-sm-3">
                                    <label class="control-label">Doc No</label>
                                    <div class="label-t">{{Doc_no}}</div>
                                </div>

                                <!-- <div class="col-sm-3">
                              <label class="control-label">From Outlet</label>
                                  <div  class="label-t">{{From_outlet}}</div>

                          </div>
                          <div class="col-sm-3">
                            <label class="control-label">To Stock Point</label>
                                <div  class="label-t">{{To_Godown_ID}}</div>

                        </div> -->
                            </div>
                            <div class="clearfix"></div>
                            <div class="table-responsive no-padding" style="overflow-x: hidden !important;">
                                <p-table [value]="AuthorizedList" [globalFilterFields]='["Product_Description","Indent_Qty","Order_Qty","Rate","Amount","Confirm_Qty","Confirm_Rate","Confirm_Amount","Vendor_Name","Remarks"]' [rowHover]="true" [autoLayout]="true" #dt2>
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right">
                                                <input type="text" pInputText size="50" placeholder="Search" (input)="dt2.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                                            </div>
                                        </div> <br>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>Material Type</th>
                                            <th>Product Type</th>
                                            <th>Product Description</th>
                                            <th>Weekly Avg. Cons</th>
                                            <th>Weekly Cons Value</th>
                                            <th>Last Purchase Date</th>
                                            <th>Last Purchase Qty</th>
                                            <th>Last Purchase Rate</th>
                                            <!-- <th>Last Purchase With Gst</th> -->
                                            <th>Current Stock</th>
                                            <th>Due Payment</th>
                                            <!-- <th>Monthly Req Value</th> -->
                                            <th>Indent Qty</th>
                                            <th>Stock Qty</th>
                                            <th>Order Qty</th>
                                            <th>Rate</th>
                                            <th>Amount</th>
                                            <!-- <th>Total Amount With GST</th> -->
                                            <th>Estimate Time Of Delivery(In Day)</th>
                                            <th>Confirm Qty</th>
                                            <th>Confirm Rate</th>
                                            <th>Confirm Amount</th>
                                            <th>Confirm Amount With GSt</th>
                                            <th>Vendor</th>
                                            <th>Cr Days</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col let-rowIndex="rowIndex">
                                        <tr [class]='textcolor(col)'>

                                            <td>{{col.Material_Type}}</td>
                                            <td>{{col.Product_Type}}</td>
                                            <td>{{col.Product_Description}}</td>
                                            <td>{{col.Weekly_Avg_Cons}}</td>
                                            <td>{{col.Weekly_Cons_Value}}</td>
                                            <td>{{col.Last_Puchase_Date | date : 'dd/MMM/yyyy'}}</td>
                                            <td>{{col.Last_Puchase_Qty}}</td>
                                            <td>{{col.Last_Purchase_Rate}}</td>
                                            <!-- <td>{{col.Last_Purchase_With_GST}}</td> -->
                                            <td>{{col.Current_Stock}}</td>
                                            <td>{{col.Due_Payment}}</td>
                                            <!-- <td>{{col.Weekly_Avg_Cons}}</td> -->
                                            <td>{{col.Indent_Qty}}</td>
                                            <td>{{col.Order_Stock_Qty}} {{col.Order_Stock_UOM}}</td>
                                            <td>{{col.Order_Qty}} {{col.Order_UOM}}</td>
                                            <td>{{col.Rate}}</td>
                                            <td>{{col.Amount}}</td>
                                            <!-- <td>{{col.Total_Amount_With_GST}}</td> -->
                                            <td>{{col.Estimated_Time_Of_Delivery}}</td>
                                            <!-- <td>{{col.Confirm_Qty}}</td> -->
                                            <td><input type="text" [name]="col.Product_ID" [(ngModel)]='col.Confirm_Qty' (ngModelChange)='confirmamountcalculate(rowIndex)' CompacctDigitonly="true" class="form-control" style="width: 71px;" /></td>
                                            <!-- <td>{{col.Confirm_Rate}}</td> -->
                                            <td><input type="text" [name]="col.Product_ID" [(ngModel)]='col.Confirm_Rate' (ngModelChange)='confirmamountcalculate(rowIndex)' CompacctDigitonly="true" class="form-control" style="width: 71px;" /></td>
                                            <td>{{col.Confirm_Amount ? col.Confirm_Amount : '-'}}</td>
                                            <td>{{col.Confirm_Amount_With_GST}}</td>
                                            <!-- <td>{{col.Vendor_Name}}</td> -->
                                            <td>
                                                <p-dropdown [options]="vendorlist" name="Appvendor" [(ngModel)]="col.Sub_Ledger_ID" [showClear]="true" [emptyFilterMessage]="' No Product Found'" (onChange)="crdchange(rowIndex)" [filter]="true" filterBy="label,value.name" [resetFilterOnHide]="true" [placeholder]="'Select Vendor'"
                                                    [virtualScroll]="true" itemSize="30" #Appvendor="ngModel">
                                                </p-dropdown>
                                                <!-- </div> -->
                                            </td>
                                            <!-- <td>{{col.Credit_days}}</td> -->
                                            <td>
                                                <input class="form-control" CompacctDigitonly="true" name="Appcreditdays" #Appcreditdays="ngModel" [(ngModel)]="col.Credit_days">
                                            </td>
                                            <td>{{col.Remarks}}</td>

                                        </tr>
                                        <tr *ngIf='rowIndex === (AuthorizedList.length - 1)'>
                                            <td colspan="14" class="text-right">Total</td>
                                            <td>{{getTotalValue('Amount')}}</td>
                                            <!-- <td>{{getTotalValue('Total_Amount_With_GST')}}</td> -->
                                            <td colspan="3" class="text-center">-</td>
                                            <td>{{getTotalValue('Confirm_Amount')}}</td>
                                            <td>{{getTotalValue('Confirm_Amount_With_GST')}}</td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>


                            <p-footer>
                                <button type="button" (click)="Approved()" class="btn btn-success">
                              <i class="fa fa-check"></i>&nbsp;  {{Appbuttonname}}
                            </button>
                                <button type="button" (click)="AuthPoppup = false" class="btn btn-default">
                               <i class="fa fa-close"></i>&nbsp;  Close
                             </button>
                            </p-footer>
                        </p-dialog>

                        <!-- VIEW POPUP -->
                        <p-dialog header="Details" [appendTo]="'body'" [(visible)]="ViewPoppup" [modal]="true" [responsive]="true" [minY]="70" [maximizable]="true" [closeOnEscape]="true" [style]="{width: '80%', minWidth: '300px'}">
                            <div class="form-group">
                                <div class="col-sm-3">
                                    <label class="control-label">Date</label>
                                    <div class="label-t">{{Doc_date | date :"dd/MMM/yyyy"}}</div>

                                </div>
                                <div class="col-sm-3">
                                    <label class="control-label">Doc No</label>
                                    <div class="label-t">{{Doc_no}}</div>
                                </div>

                                <!-- <div class="col-sm-3">
                            <label class="control-label">From Outlet</label>
                                <div  class="label-t">{{From_outlet}}</div>

                        </div>
                        <div class="col-sm-3">
                          <label class="control-label">To Stock Point</label>
                              <div  class="label-t">{{To_Godown_ID}}</div>

                      </div> -->
                            </div>
                            <div class="clearfix"></div>
                            <div class="table-responsive no-padding" style="overflow-x: hidden !important;">
                                <p-table [value]="ViewList" [globalFilterFields]='["Product_Description","Indent_Qty","Order_Qty","Rate","Amount","Confirm_Qty","Confirm_Rate","Confirm_Amount","Vendor_Name","Remarks"]' [rowHover]="true" [autoLayout]="true" #dt3>
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right">
                                                <input type="text" pInputText size="50" placeholder="Search" (input)="dt3.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>Material Type</th>
                                            <th>Product Type</th>
                                            <th>Product Description</th>
                                            <th>Weekly Avg. Cons</th>
                                            <th>Weekly Cons Value</th>
                                            <th>Last Purchase Date</th>
                                            <th>Last Purchase Qty</th>
                                            <th>Last Purchase Rate</th>
                                            <!-- <th>Last Purchase With Gst</th> -->
                                            <th>Current Stock</th>
                                            <th>Due Payment</th>
                                            <!-- <th>Monthly Req Value</th> -->
                                            <th>Indent Qty</th>
                                            <th>Order Qty</th>
                                            <th>Rate</th>
                                            <th>Amount</th>
                                            <!-- <th>Total Amount With GST</th> -->
                                            <th>Estimate Time Of Delivery(In Day)</th>
                                            <th>Confirm Qty</th>
                                            <th>Confirm Rate</th>
                                            <th>Confirm Amount</th>
                                            <th>Confirm Amount With GSt</th>
                                            <th>Vendor</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col let-rowIndex="rowIndex">
                                        <tr [class]='textcolor(col)'>

                                            <td>{{col.Material_Type}}</td>
                                            <td>{{col.Product_Type}}</td>
                                            <td>{{col.Product_Description}}</td>
                                            <td>{{col.Weekly_Avg_Cons}}</td>
                                            <td>{{col.Weekly_Cons_Value}}</td>
                                            <td>{{col.Last_Puchase_Date | date : 'dd/MMM/yyyy'}}</td>
                                            <td>{{col.Last_Puchase_Qty}}</td>
                                            <td>{{col.Last_Purchase_Rate}}</td>
                                            <!-- <td>{{col.Last_Purchase_With_GST}}</td> -->
                                            <td>{{col.Current_Stock}}</td>
                                            <td>{{col.Due_Payment}}</td>
                                            <!-- <td>{{col.Weekly_Avg_Cons}}</td> -->
                                            <td>{{col.Indent_Qty}}</td>
                                            <td>{{col.Order_Qty}}</td>
                                            <td>{{col.Rate}}</td>
                                            <td>{{col.Amount}}</td>
                                            <!-- <td>{{col.Total_Amount_With_GST}}</td> -->
                                            <td>{{col.Estimated_Time_Of_Delivery}}</td>
                                            <td>{{col.Confirm_Qty}}</td>
                                            <!-- <td><input type="text" [name]="col.Product_ID" [(ngModel)]='col.Confirm_Qty' (ngModelChange)='confirmamountcalculate(rowIndex)' CompacctDigitonly="true" class="form-control" style="width: 71px;" /></td> -->
                                            <td>{{col.Confirm_Rate}}</td>
                                            <!-- <td><input type="text" [name]="col.Product_ID" [(ngModel)]='col.Confirm_Rate' (ngModelChange)='confirmamountcalculate(rowIndex)' CompacctDigitonly="true" class="form-control" style="width: 71px;" /></td> -->
                                            <td>{{col.Confirm_Amount ? col.Confirm_Amount : '-'}}</td>
                                            <td>{{col.Confirm_Amount_With_GST}}</td>
                                            <td>{{col.Vendor_Name}}</td>
                                            <td>{{col.Remarks}}</td>

                                        </tr>
                                        <!-- <tr *ngIf='rowIndex === (AuthorizedList.length - 1)'>
                                        <td colspan="11" class = "text-right">Total</td>
                                        <td>{{getTotalValue('Amount')}}</td>
                                        <td>{{getTotalValue('Total_Amount_With_GST')}}</td>
                                        <td colspan="3" class="text-center">-</td>
                                        <td>{{getTotalValue('Confirm_Amount')}}</td>
                                        <td>{{getTotalValue('Confirm_Amount_With_GST')}}</td>
                                      </tr> -->
                                    </ng-template>
                                </p-table>
                            </div>


                            <p-footer>
                                <button *ngIf='ViewList.length' type="button" (click)="exportoexcel(ViewList,'Purchase_Planning')" class="btn btn-success">
                            <i class="glyphicon glyphicon-save"></i>&nbsp;  export to excel
                          </button>
                                <button type="button" (click)="ViewPoppup = false" class="btn btn-default">
                             <i class="fa fa-close"></i>&nbsp;  Close
                           </button>
                            </p-footer>
                        </p-dialog>

                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[1]" leftIcon="glyphicon glyphicon-floppy-save">
                            <div class="panel-group">
                                <div class="panel panel-primary">
                                    <div class="panel-body">
                                        <form name="PurchaseForm" #PurchaseForm="ngForm" novalidate>
                                            <div class="form-group">
                                                <div class="col-sm-2">
                                                    <label class="control-label">Date <sup class="text-danger">*</sup></label>
                                                    <ejs-datepicker [format]="'dd/MMM/yyyy'" [(value)]='todayDate'></ejs-datepicker>
                                                </div>
                                                <div class="col-sm-3">
                                                    <label class="control-label">Material Type <sup class="text-danger">*</sup></label>
                                                    <select class="form-control" name="materialtype" #materialtype="ngModel" [(ngModel)]="ObjMPtype.Material_Type" (change)='getproducttype()' [disabled]="productdisabled" [ngClass]="{'clearance': PurchaseFormSubmitted && producttype?.errors?.required}">
                                        <option  [ngValue]="undefined">Select</option>
                                          <option *ngFor = "let option of materialtypelist" value= "{{option.Material_Type}}">
                                            {{option.Material_Type}}
                                          </option>
                                    </select>
                                                </div>
                                                <div class="col-sm-3">
                                                    <label class="control-label">Product Type <sup class="text-danger">*</sup></label>
                                                    <select class="form-control" name="producttype" #producttype="ngModel" [(ngModel)]="ObjMPtype.Product_Type" (change)='ProductTypeChange()' [disabled]="productdisabled" [ngClass]="{'clearance': PurchaseFormSubmitted && producttype?.errors?.required}">
                                      <option  [ngValue]="undefined">Select</option>
                                        <option *ngFor = "let option of producttypelist" value= "{{option.Product_Type_ID}}">
                                          {{option.Product_Type}}
                                        </option>
                                  </select>
                                                    <!-- <p-multiSelect
                                          [options]="productListFilter"
                                          [(ngModel)]="SelectedProductType"
                                          [styleClass]="'compacct-multiselect'"
                                          name="ProductTypefilter"
                                          (onChange)= "filterProduct()">
                                   </p-multiSelect> -->
                                                </div>
                                                <div class="col-sm-4">
                                                    <label class="control-label">Product <sup class="text-danger">*</sup> &nbsp;
                                      <span ><a  *ngIf="!Orderlist.length" (click)="ProductDropdownChange()">{{data}}</a></span>
                                    </label>
                                                    <p-dropdown [options]="Productlist" name="Product" [(ngModel)]="ObjPurchasePlan.Product_ID" [showClear]="true" [emptyFilterMessage]="' No Product Found'" (onChange)="ProductChange()" [filter]="true" filterBy="label,value.name" [resetFilterOnHide]="true"
                                                        [placeholder]="'Select Product'" [virtualScroll]="true" itemSize="30" #Product="ngModel" [disabled]="productdisabled" [required]="true" [ngClass]="{'clearance':PurchaseFormSubmitted && Product?.errors?.required}"
                                                        required>
                                                    </p-dropdown>
                                                </div>
                                                <!-- <div class="col-sm-2">
                                                    <label class="control-label">UOM <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="uom" #uom="ngModel" [(ngModel)]="ObjPurchasePlan.UOM" [(disabled)]="uomdisabeld" [ngClass]="{'clearance':PurchaseFormSubmitted && uom?.errors?.required}" required>
                                                </div> -->
                                                <!-- <div class="col-sm-1">
                                                    <label class="control-label">Rate <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="rate" #rate="ngModel" [(ngModel)]= "ObjPurchasePlan.Sale_rate" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && rate?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <label class="control-label">Qty <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="Qty" #Qty="ngModel" [(ngModel)]= "ObjPurchasePlan.Stock_Qty" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && Qty?.errors?.required}" required>
                                                </div> -->
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-3">
                                                    <label class="control-label">Weekly Avg. consumption <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="weekavgcons" #weekavgcons="ngModel" [(ngModel)]="ObjPurchasePlan.Weekly_Avg_Cons" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && weekavgcons?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <!-- <label class="control-label">UOM <sup class="text-danger">*</sup></label> -->
                                                    <label></label>
                                                    <input class="form-control" name="uom" #uom="ngModel" [(ngModel)]="ObjPurchasePlan.UOM" [(disabled)]="uomdisabeld">
                                                </div>
                                                <div class="col-sm-3">
                                                    <label class="control-label">Weekly consumption Value<sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="weekconsval" #weekconsval="ngModel" [(ngModel)]="ObjPurchasePlan.Weekly_Cons_Value" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && weekconsval?.errors?.required}" required>
                                                </div>
                                                <!-- <div class="col-sm-4">
                                                    <label class="control-label">Select Vendor <sup class="text-danger">*</sup></label>
                                                    <div class="col-sm-2 pull-right" style="width:170px;">
                                                        <small><b>Local Purchase</b></small>
                                                        <p-checkbox [(ngModel)]='localpurchaseFLag' name='localpurchase' (onChange)='checkboxchange()' [binary]="true"></p-checkbox>

                                                    </div>
                                                    <select class="form-control" name="vendor" #vendor="ngModel" [(ngModel)]= "ObjPurchasePlan.Vendor" [(disabled)]= "vendordisabled" [ngClass]="{'clearance': PurchaseFormSubmitted && vendor?.errors?.required}" required>
                                                   <option  [ngValue]="undefined">Select</option>
                                                     <option *ngFor = "let option of vendorlist" value= "{{option.Sub_Ledger_ID}}">
                                                       {{option.Sub_Ledger_Name}}
                                                     </option>
                                               </select>
                                                </div> -->
                                                <div class="col-sm-2">
                                                    <label class="control-label">Last Purchase Date <sup class="text-danger">*</sup></label>
                                                    <ejs-datepicker [format]="'dd/MMM/yyyy'" [(value)]='LastPurDate'></ejs-datepicker>
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Last Purchase Qty <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="lastPurQty" #lastPurQty="ngModel" [(ngModel)]="ObjPurchasePlan.Last_Purchase_Qty" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && lastPurQty?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <!-- <label class="control-label">UOM <sup class="text-danger">*</sup></label> -->
                                                    <label></label>
                                                    <input class="form-control" name="aluom" #aluom="ngModel" [(ngModel)]="ObjPurchasePlan.AL_UOM" [(disabled)]="uomdisabeld">
                                                </div>

                                                <!-- <div class="col-sm-3">
                                                <label class="control-label">Last Purchase With Gst <sup class="text-danger">*</sup></label>
                                                <input class="form-control" name="lastPurgstQty" #lastPurgstQty="ngModel" [(ngModel)]="ObjPurchasePlan.Last_Purchase_With_GST" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && lastPurgstQty?.errors?.required}" required>
                                            </div> -->


                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-2">
                                                    <label class="control-label">Last Purchase Rate <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="lastPurrate" #lastPurrate="ngModel" [(ngModel)]="ObjPurchasePlan.Last_Purchase_Rate" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && lastPurrate?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Current Stock <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="currentstock" #currentstock="ngModel" [(ngModel)]="ObjPurchasePlan.Current_Stock" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && currentstock?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <!-- <label class="control-label">UOM <sup class="text-danger">*</sup></label> -->
                                                    <label></label>
                                                    <input class="form-control" name="pcsuom" #pcsuom="ngModel" [(ngModel)]="ObjPurchasePlan.Pcs_UOM" [(disabled)]="uomdisabeld">
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Due Payment <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="duepayment" #duepayment="ngModel" [(ngModel)]="ObjPurchasePlan.Due_Payment" [ngClass]="{'clearance':PurchaseFormSubmitted && duepayment?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Order Qty <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="Qty1" #Qty1="ngModel" [(ngModel)]="ObjPurchasePlan.Order_Qty" (change)='OrderValueChange()' CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && Qty1?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <!-- <label class="control-label">UOM <sup class="text-danger">*</sup></label> -->
                                                    <label></label>
                                                    <input class="form-control" name="altuom" #altuom="ngModel" [(ngModel)]="ObjPurchasePlan.Alt_UOM" [(disabled)]="uomdisabeld">
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Current Rate <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="rate" #rate="ngModel" [(ngModel)]="ObjPurchasePlan.Sale_rate" (change)='OrderValueChange()' CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && rate?.errors?.required}" required>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-2">
                                                    <label class="control-label">Order Value <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="Ovalue" #Ovalue="ngModel" [(ngModel)]="ObjPurchasePlan.Order_Value" [disabled]="ovaldisabled" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && Ovalue?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-2">
                                                    <label class="control-label">Stock Qty <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" name="Qty" #Qty="ngModel" [(ngModel)]="ObjPurchasePlan.Stock_Qty" [disabled]="stockqtydisabled" CompacctDigitonly="true" [ngClass]="{'clearance':PurchaseFormSubmitted && Qty?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-1">
                                                    <label></label>
                                                    <input class="form-control" name="stockuom" #stockuom="ngModel" [(ngModel)]="ObjPurchasePlan.Stock_UOM" [(disabled)]="uomdisabeld">
                                                </div>
                                                <div class="col-sm-4">
                                                    <label class="control-label">Estimate Time Of Delivery(In Day) <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" onkeydown="if(event.key==='.'){event.preventDefault();}" oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');" CompacctDigitonly="true" name="estimedel" #estimedel="ngModel" [(ngModel)]="ObjPurchasePlan.Estimated_Time_Of_Delivery"
                                                        [ngClass]="{'clearance':PurchaseFormSubmitted && estimedel?.errors?.required}" required>
                                                </div>
                                                <div class="col-sm-3">
                                                    <label class="control-label">Remarks</label>
                                                    <textarea class="form-control" name="Remarks" #Remarks="ngModel" [(ngModel)]="ObjPurchasePlan.Remarks" [ngClass]="{'clearance':PurchaseFormSubmitted && Remarks?.errors?.required}"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-4">
                                                    <label class="control-label">Select Vendor <sup class="text-danger">*</sup></label>
                                                    <!-- <div class="col-sm-2 pull-right" style="width:170px;">
                                                        <small><b>Local Purchase</b></small>
                                                        <p-checkbox [(ngModel)]='localpurchaseFLag' name='localpurchase' (onChange)='checkboxchange()' [binary]="true"></p-checkbox>

                                                    </div> -->
                                                    <p-dropdown [options]="vendorlist" name="vendor" [(ngModel)]="ObjPurchasePlan.Vendor_ID" [showClear]="true" [emptyFilterMessage]="' No Product Found'" (onChange)="CreditDaysChange()" [filter]="true" filterBy="label,value.name" [resetFilterOnHide]="true"
                                                        [placeholder]="'Select Vendor'" [virtualScroll]="true" itemSize="30" #vendor="ngModel" [(disabled)]="vendordisabled" [required]="true" [ngClass]="{'clearance':PurchaseFormSubmitted && vendor?.errors?.required}"
                                                        required>
                                                    </p-dropdown>
                                                </div>
                                                <!-- <select class="form-control" name="vendor" #vendor="ngModel" [(ngModel)]="ObjPurchasePlan.Vendor" [(disabled)]="vendordisabled" [ngClass]="{'clearance': PurchaseFormSubmitted && vendor?.errors?.required}" required>
                                           <option  [ngValue]="undefined">Select</option>
                                             <option *ngFor = "let option of vendorlist" value= "{{option.Sub_Ledger_ID}}">
                                               {{option.Sub_Ledger_Name}}
                                             </option>
                                       </select> 
                                            </div> -->
                                                <div class="col-sm-2">
                                                    <label class="control-label">Credit Days <sup class="text-danger">*</sup></label>
                                                    <input class="form-control" CompacctDigitonly="true" name="creditdays" #creditdays="ngModel" [(ngModel)]="ObjPurchasePlan.Credit_Days" [ngClass]="{'clearance':PurchaseFormSubmitted && creditdays?.errors?.required}" required>
                                                </div>

                                                <div class="col-sm-1">
                                                    <button id="row-Add" class="btn btn-primary custombutton2" (click)="addProduct(PurchaseForm.form.valid)">
                                          <!-- <i class="fa fa-fw fa-add"></i>&nbsp; Add --> Add
                                            </button>
                                                </div>
                                                <div class="col-sm-1">
                                                    <button id="row-Add" class="btn btn-primary custombutton2" (click)="Refresh()">
                                          <!-- <i class="fa fa-fw fa-add"></i>&nbsp; Add --> Clear
                                            </button>
                                                </div>
                                            </div>
                                            <!-- <div class="form-group">
                                            </div> -->
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <br>
                            <div class="table-responsive no-padding">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr style="background-color:#4fa1d1;color:white;">
                                            <th>Material Type</th>
                                            <th>Product Type</th>
                                            <th>Product Description</th>
                                            <th>Weekly Avg. Cons</th>
                                            <th>Weekly Cons Value</th>
                                            <th>Last Purchase Date</th>
                                            <th>Last Purchase Qty</th>
                                            <th>Last Purchase Rate</th>
                                            <th>Current Stock</th>
                                            <th>Due Payment</th>
                                            <th>Order Qty</th>
                                            <th>Current Rate</th>
                                            <th>Order Value</th>
                                            <th>Stock Oty</th>
                                            <th>Estimate Time Of Delivery(In Day)</th>
                                            <th>Remarks</th>
                                            <!-- <th>Last Purchase With Gst</th>
                                            <th>Monthly Req Value</th>
                                            <th>Indent Qty</th>
                                            <th>Rate</th>
                                            <th>Amount</th>
                                            <th>Total Amount With GST</th> -->
                                            <th>Vendor</th>
                                            <th>Cr Days</th>
                                            <th>Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let obj of productaddSubmit ; let ind = index;" [class]='getClass(obj)'>
                                            <!--let ind = index; -->
                                            <td>{{obj.Material_Type}}</td>
                                            <td>{{obj.Product_Type}}</td>
                                            <td>{{obj.Product_Description}}</td>
                                            <td>{{obj.Weekly_Avg_Cons}} {{obj.UOM}}</td>
                                            <td>{{obj.Weekly_Cons_Value}}</td>
                                            <td>{{obj.Last_Puchase_Date}}</td>
                                            <td>{{obj.Last_Puchase_Qty}} {{obj.AL_UOM}}</td>
                                            <td>{{obj.Last_Purchase_Rate}}</td>
                                            <td>{{obj.Current_Stock}} {{obj.Pcs_UOM}}</td>
                                            <td>{{obj.Due_Payment}}</td>
                                            <td>{{obj.Order_Qty}} {{obj.Alt_UOM}}</td>
                                            <td>{{obj.Sale_rate}}</td>
                                            <td>{{obj.Order_Value}}</td>
                                            <td>{{obj.Stock_Qty}} {{obj.Stock_UOM}}</td>
                                            <td>{{obj.Estimated_Time_Of_Delivery}}</td>
                                            <td>{{obj.Remarks}}</td>
                                            <!-- <td>{{obj.Last_Purchase_With_GST}}</td>
                                            <td>{{obj.Indent_Qty}}</td>
                                            <td>{{obj.Stock_Qty}}</td>
                                            <td>{{obj.Sale_rate}}</td>
                                            <td>{{obj.Amount}}</td>
                                            <td>{{obj.Total_Amount_With_GST}}</td> -->
                                            <!-- <td>{{obj.UOM}}</td> -->
                                            <!-- <td>{{obj.Vendor}}</td>
                                            <td>{{obj.Credit_days}}</td> -->
                                            <td>
                                                <p-dropdown [options]="vendorlist" name="createvendor" [(ngModel)]="obj.Vendor_ID" [showClear]="true" [emptyFilterMessage]="' No Product Found'" (onChange)="crdayschange(ind)" [filter]="true" filterBy="label,value.name" [resetFilterOnHide]="true" [placeholder]="'Select Vendor'"
                                                    [virtualScroll]="true" itemSize="30" #createvendor="ngModel">
                                                </p-dropdown>
                                                <!-- </div> -->
                                            </td>
                                            <!-- <td>{{col.Credit_days}}</td> -->
                                            <td>
                                                <input class="form-control" style="width: 71px;" CompacctDigitonly="true" name="createcreditdays" #createcreditdays="ngModel" [(ngModel)]="obj.Credit_days">
                                            </td>
                                            <td *ngIf="!obj?.deleteflag"><button (click)="delete(ind)" class="btn danger"><i class="fa fa-trash"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- <hr class="box boxboxDivide-primary ng-scope"> -->

                            <div class="box-footer">
                                <button class="btn btn-primary pull-right" (click)="SaveProduct()" id="load" [disabled]="Spinner">
                           <p-progressSpinner *ngIf="Spinner" [style]="{width: '15px', height: '15px'}" strokeWidth="8"  animationDuration=".5s"></p-progressSpinner>
                       <span *ngIf="!Spinner" class="glyphicon glyphicon-save"></span>{{buttonname}}
                   </button>
                            </div>
                        </p-tabPanel>
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[2]" leftIcon="glyphicon glyphicon-list-alt">
                            <form name="StockLevelForm" #StockLevelForm="ngForm" novalidate>
                                <div class="form-group">
                                    <!-- <div class="col-sm-3">
                                        <label class="control-label">Material Type <sup class="text-danger">*</sup></label>
                                        <select class="form-control" name="materialtype2" #materialtype2="ngModel" [(ngModel)]="ObjStockLevel.Material_Type" [ngClass]="{'clearance': StockLevelFormSubmitted && materialtype2?.errors?.required}" required>
                                             <option  [ngValue]="undefined">Select</option>
                                                 <option *ngFor = "let option of materialtypelist" value= "{{option.Material_Type}}">
                                                    {{option.Material_Type}}
                                                 </option>
                                        </select>
                                    </div> -->
                                    <div class="col-sm-3">
                                        <label class="control-label">Cost Center<sup class="text-danger">*</sup></label>
                                        <select class="form-control" name="Cost_Cen_ID" #Cost_Cen_ID="ngModel" [(ngModel)]="ObjStockLevel.Cost_Cen_ID" [ngClass]="{'clearance': StockLevelFormSubmitted && Cost_Cen_ID?.errors?.required}" (change)="GetGodown()" required>
                                                <option  [ngValue]="undefined">Select</option>
                                                <option  *ngFor="let option of costcenlist" value="{{option.Cost_Cen_ID}}">
                                                  {{option.Cost_Cen_Name}}
                                                </option>
                                          </select>
                                    </div>
                                    <div class="col-sm-3">
                                        <label class="control-label">Stock Point<sup class="text-danger">*</sup></label>
                                        <select class="form-control" name="Godown_ID" #Godown_ID="ngModel" [(ngModel)]="ObjStockLevel.Godown_ID" [ngClass]="{'clearance': StockLevelFormSubmitted && Godown_ID?.errors?.required}" required>
                                                <option  [ngValue]="undefined">Select</option>
                                                <option  *ngFor="let option of GodownList" value="{{option.godown_id}}">
                                                  {{option.godown_name}}
                                                </option>
                                          </select>
                                    </div>

                                    <div class="col-sm-3">
                                        <button class="btn btn-primary custombutton3" data-toggle="modal" id="load" (click)="StockReportSearch(StockLevelForm.form.valid)" [disabled]="seachSpinner">
                                      <p-progressSpinner
                                        *ngIf="seachSpinner"
                                        [style]="{ width: '15px', height: '15px' }"
                                        strokeWidth="8"
                                        animationDuration=".5s"
                                      ></p-progressSpinner>
                                      <span
                                        *ngIf="!seachSpinner"
                                        class="glyphicon glyphicon-search"
                                      ></span
                                      >&nbsp;Search
                                    </button> &nbsp;&nbsp;
                                        <button type="button" (click)="exportoexcel3(StockReportSearchlist,'Order_Stock_Report')" [disabled]='!StockReportSearchlist.length' class="btn btn-success custombutton3">
                                        <i class="glyphicon glyphicon-save"></i>&nbsp;  export to excel
                                    </button>
                                    </div>
                                </div>
                            </form>
                            <div class="form-group" *ngIf='BackupStockReportSearchlist.length' style="padding:15px">

                                <fieldset class="col-md-12">
                                    <legend>Filter</legend>

                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">Material Type <span class="text-danger"></span></label>
                                            <p-multiSelect [options]="DistMaterialType" [(ngModel)]="SelectedDistMaterialType" itemSize="30" (onChange)='FilterDist()' [styleClass]="'compacct-multiselect'" name="Material_Type"></p-multiSelect>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Product Type <span class="text-danger"></span></label>
                                            <p-multiSelect [options]="DistProductType" [(ngModel)]="SelectedDistProductType" itemSize="30" (onChange)='FilterDist()' [styleClass]="'compacct-multiselect'" name="Product_Type"></p-multiSelect>
                                        </div>
                                    </div>

                                </fieldset>
                            </div>
                            <div class="row">
                                <div class="col-sm-8">
                                    <h5><strong></strong></h5>
                                </div>
                            </div>
                            <div class="table-responsive table-id">
                                <p-table [value]="StockReportSearchlist" #dt4 [paginator]="true" [rows]="100" [loading]="seachSpinner" [rowHover]="true" [autoLayout]="true" sortMode="multiple" [rowsPerPageOptions]="[10,25,50,100]" [rowHover]="true" [globalFilterFields]='["Product_Description","Last_Purchase_Qty","Last_Purchase_Date","Stock_Qty","Reorder_Level","Critical_Level"]'>
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right">
                                                <input type="text" pInputText size="50" placeholder="Search" (input)="dt4.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:5em">Action</th>
                                            <th>Product Name</th>
                                            <th>UOM</th>
                                            <th>Last Purchase Qty</th>
                                            <th>Last Purchase Date</th>
                                            <th>Current Stock</th>
                                            <th>Notification Level</th>
                                            <th>Critical Level</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col>
                                        <tr>
                                            <td>
                                                <button type="button" (click)="Order(col)" class="btn btn-primary">
                                                    <i class="fa fa-pencil-square-o"></i>&nbsp;  Order
                                                </button>
                                            </td>
                                            <td [class]='col.textClass'>{{col.Product_Description}}</td>
                                            <td [class]='col.textClass'>{{col.UOM}}</td>
                                            <td [class]='col.textClass'>{{col.Last_Purchase_Qty ? col.Last_Purchase_Qty : '-'}}</td>
                                            <td [class]='col.textClass'>{{col.Last_Purchase_Date | date : 'dd/MMM/yyyy'}}</td>
                                            <td [class]='col.textClass'>{{col.Stock_Qty}}</td>
                                            <!-- <td>{{col.Reorder_Level ? col.Reorder_Level : '-'}}</td> -->
                                            <td [class]='col.textClass'>{{col.Reorder_Level }}</td>
                                            <td [class]='col.textClass'>{{col.Critical_Level }}</td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="paginatorright" let-state>
                                        Showing {{state.first+1}} of {{(state.first+1) + state.rows}} of {{state.totalRecords}}
                                    </ng-template>
                                </p-table>

                            </div>

                        </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </div>
    </div>
</div>