<p-toast key="compacct-toast" baseZIndex="99999">
</p-toast>
<p-toast position="center" key="c" (onClose)="onReject()" [modal]="true" [autoZIndex]="true">
    <ng-template let-message pTemplate="message">
        <div style="text-align: center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3em"></i>
            <h3>{{message.summary}}</h3>
            <p>{{message.detail}}</p>
        </div>

        <div class="ui-g ui-fluid">
            <div class="ui-g-6">
                <button type="button" pButton (click)="onConfirm()" label="Yes" class="ui-button-success"></button>
            </div>
            <div class="ui-g-6">
                <button type="button" pButton (click)="onReject()" label="No" class="ui-button-secondary"></button>
            </div>
        </div>
    </ng-template>
</p-toast>

<div class="row">
    <div class="col-xs-12">
        <div class="box box-primary">
            <div class="form-horizontal">
                <div class="box-body">
                    <p-tabView [activeIndex]="tabIndexToView" (onChange)="TabClick($event)">
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[0]"
                            leftIcon="glyphicon glyphicon-list-alt">
                            <form name="SearchSaleBillForm" #SearchSaleBillForm="ngForm" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-3">
                                        <label class="control-label">Date</label>
                                        <app-compacct-daterangepicker (DaterangeObj)="getDateRange($event)"
                                            [HardCodeDateOpt]="initDate">
                                        </app-compacct-daterangepicker>
                                    </div>
                                    <div class="col-sm-3">
                                        <label class="control-label">Customer</label>
                                        <select class="form-control" name="Customer" #Customer="ngModel"
                                            [(ngModel)]="ObjBrowseSaleBill.Sub_Ledger_ID">
                                            <option [ngValue]="undefined">Select</option>
                                            <option *ngFor="let option of CustmerListbrowse" value="{{option.value}}">
                                                {{option.Sub_Ledger_Billing_Name}}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-sm-3">
                                        <button class="btn btn-primary custombutton" data-toggle="modal"
                                            (click)="GetSerarchBrowse(SearchSaleBillForm.form.valid)">
                                            <span class="glyphicon glyphicon-search"></span>&nbsp;Search
                                        </button>
                                    </div>
                                </div>
                            </form>

                            <div class="table-id">
                                <p-table [value]="SerarchSaleBill" *ngIf="SerarchSaleBill.length"
                                    [paginator]="true" [rows]="100" [loading]="seachSpinner" [rowHover]="true"
                                    [autoLayout]="true" sortMode="multiple" [rowsPerPageOptions]="[100, 300, 500]"
                                    [globalFilterFields]='SerarchSaleBillHeader' [rowHover]="true" #dt2>
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right">
                                                <input type="text" pInputText size="50" placeholder="Search"
                                                    (input)="dt2.filterGlobal($event.target.value, 'contains')"
                                                    class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:5em">Action</th>
                                            <th *ngFor="let option of SerarchSaleBillHeader">
                                                {{option.replaceAll('_',' ')}}</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col>
                                        <tr>
                                            <td>
                                                <div class="dropdown">
                                                    <button class="btn btn-default btn-sm tableButton dropdown-toggle"
                                                        type="button" data-toggle="dropdown" style="height:27px">
                                                        <i class="fa fa-fw fa-bars"></i>
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <!-- <li>
                                                            <a (click)="Print(col.Doc_No)">
                                                                <i class="fa fa-fw fa-print"></i> Print
                                                            </a>
                                                        </li> -->
                                                        <li>
                                                            <a (click)="Delete(col)">
                                                                <i class="fa fa-fw fa-trash"></i> Delete
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                            <ng-container *ngFor="let option of SerarchSaleBillHeader">
                                                <td nowrap="nowrap">{{col[option]}}</td>
                                            </ng-container>

                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </p-tabPanel>

                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[1]"
                            leftIcon="glyphicon glyphicon-floppy-save">
                            <form name="SaleBillForm" #SaleBillForm="ngForm" novalidate>
                                <div class="col-sm-3">
                                    <h4><i class="fa fa-user"></i>&nbsp; &nbsp;<strong>Customer's Details:</strong></h4>
                                </div> <br>
                                <div class="form-group">
                                    <div class="clearfix"></div>
                                         <div class="col-sm-4"> 
                                            <label class="control-label">Customer's<sup class="text-danger">*</sup></label>
                                            <p-dropdown [options]="CustmerList" name="Billvendor" #Billvendor="ngModel"
                                                [(ngModel)]="ObjTopSale.Sub_Ledger_ID" [showClear]="true"
                                                [emptyFilterMessage]="' No Buyer s Found'"
                                                (onChange)="CustmerNameChange()" [filter]="true"
                                                filterBy="label,value.name" [resetFilterOnHide]="true"
                                                [placeholder]="'Select Customer'" [virtualScroll]="true" itemSize="30"
                                                [ngClass]="{'clearance':SaleBillFormSubmitted && Billvendor?.errors?.required}"
                                                [required]="true">
                                            </p-dropdown>
                                        </div>
                                        <div class="col-sm-4">
                                            <label class="control-label">Choose Address</label>
                                            <select class="form-control" name="billchooseaddress"
                                                #billchooseaddress="ngModel"
                                                [(ngModel)]="ObjTopSale.Choose_Address" (change)="onChangeAdd()">
                                                <option [ngValue]="undefined">Select</option>
                                                <option *ngFor="let option of SaveAddress"
                                                    value="{{option.Address_Caption}}">
                                                    {{option.Address_Caption}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-sm-4">
                                            <label class="control-label">Address<sup class="text-danger">*</sup></label>
                                            <input class="form-control" name="billaddress" #billaddress="ngModel"
                                                [(ngModel)]="ObjTopSale.Sub_Ledger_Address_1" placeholder="Address"
                                                [disabled]="ObjTopSale.Choose_Address"
                                                [ngClass]="{'clearance':SaleBillFormSubmitted && billaddress?.errors?.required}"
                                                required>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="col-sm-3">
                                            <label class="control-label">PIN<sup class="text-danger">*</sup> </label>
                                            <input class="form-control" name="billpin" #billpin="ngModel" [(ngModel)]="ObjTopSale.Sub_Ledger_Pin"
                                            (ngModelChange)="StateDistrictChange(ObjTopSale.Sub_Ledger_Pin)"
                                                placeholder="PIN" [disabled]="ObjTopSale.Choose_Address"
                                                [ngClass]="{'clearance':SaleBillFormSubmitted && billpin?.errors?.required}" required>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">District<sup
                                                    class="text-danger">*</sup></label>
                                            <input class="form-control" name="billdistrict" #billdistrict="ngModel"
                                                [(ngModel)]="ObjTopSale.Sub_Ledger_District" placeholder="District"
                                                [disabled]="ObjTopSale.Choose_Address"
                                                [ngClass]="{'clearance':SaleBillFormSubmitted && billdistrict?.errors?.required}"
                                                required>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">State<sup class="text-danger">*</sup></label>
                                            <select class="form-control" name="billstate" #billstate="ngModel"
                                                [(ngModel)]="ObjTopSale.Sub_Ledger_State"
                                                [disabled]="ObjTopSale.Choose_Address"
                                                [ngClass]="{'clearance': SaleBillFormSubmitted && billstate?.errors?.required}"
                                                required>
                                                <option [ngValue]="undefined">Select</option>
                                                <option *ngFor="let option of StateList" value="{{option.state}}">
                                                    {{option.state}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">GST No<sup class="text-danger">*</sup> </label>
                                            <input class="form-control" name="billgstno" #billgstno="ngModel"
                                                [(ngModel)]="ObjTopSale.Sub_Ledger_GST_No" placeholder="GST No"
                                                pattern="^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$"
                                                [disabled]="ObjTopSale.Choose_Address"
                                                [ngClass]="{'clearance':SaleBillFormSubmitted && (billgstno?.errors?.required || billgstno?.errors?.pattern)}"
                                                required>
                                        </div>

                                </div>
                                <hr class="box boxboxDivide-primary" />
                                <div class="form-group" style="padding: 1em;">
                                    <h4 style="padding: 0.5em 1em; margin-top:-37px;">
                                        <i class="fa fa-info-circle">
                                        </i> &nbsp;<strong>Cost Cente Details :</strong>
                                    </h4>
                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">CostCenter<sup
                                                    class="text-danger">*</sup></label>
                                            <select class="form-control" name="costcenter" #costcenter="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_ID"
                                                [disabled]="$CompacctAPI.CompacctCookies.User_Type != 'A'"
                                                (change)="GetCosCenAddress()"
                                                [ngClass]="{'clearance': SaleBillFormSubmitted && costcenter?.errors?.required}"
                                                required>
                                                <option [ngValue]="undefined">Select</option>
                                                <option *ngFor="let option of CostCenterList"
                                                    value="{{option.Cost_Cen_ID}}">
                                                    {{option.Cost_Cen_Name}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Address1 </label>
                                            <input class="form-control" name="costcenaddress" #costcenaddress="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Address1" placeholder="Address"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Address2 </label>
                                            <input class="form-control" name="address2" #address2="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Address2" placeholder="Address"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">State </label>
                                            <input class="form-control" name="costcenstate" #costcenstate="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_State" placeholder="State"
                                                [disabled]="true">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">GST No </label>
                                            <input class="form-control" name="costcengstno" #costcengstno="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_GST_No" placeholder="GST No"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Location </label>
                                            <input class="form-control" name="location" #location="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Location" placeholder="Location"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">PIN </label>
                                            <input class="form-control" name="costcenpin" #costcenpin="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_PIN" placeholder="PIN"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">District </label>
                                            <input class="form-control" name="costcendistrict"
                                                #costcendistrict="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_District" placeholder="District"
                                                [disabled]="true">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">Country </label>
                                            <input class="form-control" name="costcencountry" #costcencountry="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Country" placeholder="Country"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Mobile </label>
                                            <input class="form-control" name="costcenmobile" #costcenmobile="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Mobile" placeholder="Mobile"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Phone </label>
                                            <input class="form-control" name="costcenphone" #costcenphone="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Phone" placeholder="Phone"
                                                [disabled]="true">
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Email </label>
                                            <textarea class="form-control" name="costcenemail" #costcenemail="ngModel"
                                                [(ngModel)]="ObjTopSale.Cost_Cen_Email" placeholder="Email"
                                                [disabled]="true"></textarea>
                                        </div>
                                    </div>
                                </div>

                            <hr class="box boxboxDivide-primary" />
                                <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">Bill Date<sup class="text-danger">*</sup></label>
                                            <div class="input-group date">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                                <ejs-datepicker [format]="'dd/MMM/yyyy'"
                                                    [(value)]='BillDate'></ejs-datepicker>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <label class="control-label">Challan No<sup class="text-danger">*</sup></label>
                                            <p-multiSelect [options]="ChallanNoList"
                                            name="Challan" 
                                            #Challan="ngModel"
                                            [(ngModel)]="ObjTopSale.Bill_No" 
                                            [virtualScroll]="true" itemSize="30"
                                            (onChange)="getButtomTable()"
                                            [styleClass]="'compacct-multiselect'"
                                            [ngClass]="{'clearance':SaleBillFormSubmitted && Challan?.errors?.required}"
                                            [required]="true" >
                                            </p-multiSelect>
                                        </div>
                                     </div>
                            </form>
                            <br>
                          
                                <br>
                                <div class="table-responsive no-padding">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr style="background-color:#3c8dbc;color:white;">
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Sl. No.</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Cost Center</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Stock Point</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Product Type</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Product Sub Type</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Product Description</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Lot No./Batch No.</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">QTY</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">UOM</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Rate</th>
                                                <th nowrap rowspan="2" class="text-center"
                                                    style="vertical-align:middle">Taxable Amount</th>
                                                <th colspan="2" scope="colgroup" class="text-center">CGST</th>
                                                <th colspan="2" scope="colgroup" class="text-center">SGST</th>
                                                <th colspan="2" scope="colgroup" class="text-center">IGST</th>
                                                <th rowspan="2" class="text-center" style="vertical-align:middle">Net Amount</th>
                                               
                                            </tr>
                                            <tr style="background-color:#3c8dbc;color:white">
                                                <th scope="col" class="text-center">Rate</th>
                                                <th scope="col" class="text-center">Amt.</th>
                                                <th scope="col" class="text-center">Rate</th>
                                                <th scope="col" class="text-center">Amt.</th>
                                                <th scope="col" class="text-center">Rate</th>
                                                <th scope="col" class="text-center">Amt.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor=" let Table of GridList; let ind = index;" >
                                                <td>{{ ind + 1 }}</td>
                                                <td>{{ Table.Cost_Cen_Name ? Table.Cost_Cen_Name :"-" }}</td>
                                                <td>{{ Table.godown_name ? Table.godown_name :"-" }}</td>
                                                <td>{{ Table.Product_Type ? Table.Product_Type :"-" }}</td>
                                                <td>{{ Table.Product_Sub_Type ? Table.Product_Sub_Type :"-" }}</td>
                                                <td>{{ Table.Product_Description ? Table.Product_Description :"-" }}</td>
                                                <td>{{ Table.Batch_Number ? Table.Batch_Number :"-" }}</td>
                                                <td>{{ Table.Qty ? Table.Qty :"-" }}</td>
                                                <td>{{ Table.UOM ? Table.UOM :"-" }}</td>
                                                <td>{{ Table.Rate ? Table.Rate :"-" }}</td>
                                                <td>{{ Table.Taxable_Amount ? Table.Taxable_Amount :"-" }}</td>
                                                <td>{{ Table.CGST_Rate ? Table.CGST_Rate :"-" }}</td>
                                                <td>{{ Table.CGST_Amount ? Table.CGST_Amount :"-" }}</td>
                                                <td>{{ Table.SGST_Rate ? Table.SGST_Rate :"-" }}</td>
                                                <td>{{ Table.SGST_Amount ? Table.SGST_Amount :"-" }}</td>
                                                <td>{{ Table.IGST_Rate ? Table.IGST_Rate :"-" }}</td>
                                                <td>{{ Table.IGST_Amount ? Table.IGST_Amount :"-" }}</td>
                                                <td>{{ Table.Line_Total_Amount ? Table.Line_Total_Amount :"-" }}</td>
                                               
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                           

                            <div class="col-xs-12">
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <th>Taxable Amount :</th>
                                                <td class="amt-td ng-binding">{{Tax ? Tax :"-"}}</td>
                                                <th>CGST Amount :</th>
                                                <td class="amt-td ng-binding">{{CGST ? CGST :"-"}}</td>
                                                <th>SGST Amount :</th>
                                                <td class="amt-td ng-binding">{{SGST ? SGST : "-"}}</td>
                                                
                                            </tr>
                                            <tr>
                                                <th>IGST Amount :</th>
                                                <td class="amt-td ng-binding">{{IGST ? IGST :"-"}}</td>
                                                <th>Net Amount : </th>
                                                <td class="amt-td ng-binding">{{NetAMT ? NetAMT :"-"}}</td>
                                            </tr>
                                           
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <hr class="box boxboxDivide-primary ng-scope">
                            <div class="box-footer">
                                <button class="btn btn-primary pull-right"
                                    (click)="SaveSaleBill(SaleBillForm.form.valid)" id="load" [disabled]="Spinner">
                                    <p-progressSpinner *ngIf="Spinner" [style]="{width: '15px', height: '15px'}"
                                        strokeWidth="8" animationDuration=".5s"></p-progressSpinner>
                                    <span *ngIf="!Spinner" class="glyphicon glyphicon-save"></span>{{buttonname}}
                                </button>
                            </div>
                        </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </div>
    </div>
</div>

